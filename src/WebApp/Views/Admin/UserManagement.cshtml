
@model WebApp.ViewModels.AdminUserManagementViewModel
@{
    ViewBag.Title = "User-Management";
}

<div class="container my-5">
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Schließen"></button>
    </div>
}
<div class="mb-4">
    <a href="@Url.Action("Dashboard", "Home")" class="btn btn-outline-secondary">
        Zurück zum Dashboard
    </a>
    
    </div>
        
    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link"  asp-controller="Admin" asp-action="AdminPage">Projekte</a>
        </li>
        <li class="nav-item"> 
            <a class="nav-link active" aria-current="page"a sp-controller="Admin" asp-action="UserManagement">Benutzer</a>
        </li> 
    </ul>

    <div class="d-flex justify-content-between align-items-center flex-wrap mb-3">
        <h2 class="mb-3">Stammdaten Übersicht</h2>
        <div class="d-flex gap-2">
            <a href="@Url.Action("CreateUser", "Admin")" class="btn btn-dark mt-2 mt-md-0">User anlegen</a>
            <div class="input-group" style="max-width: 300px;">
                <input type="text" class="form-control" id="searchInput" placeholder="Suchen..."/>
            </div>
        </div>
    </div>
    <p class="text-muted">Verwalten Sie hier alle Stammdaten der User.</p>
    <div class="card shadow-sm p-3 mb-4">
    <div class="table-responsive shadow-sm rounded">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Rolle</th>
                <th>Status</th>
               <th>Aktion</th>
            </tr>
            </thead>
            <tbody>
            @if (!Model.Users.Any())
            {
                <tr>
                    <td colspan="6" class="text-center text-muted">Kein User gefunden.</td>
                </tr>
            }
            else
            {
                foreach (var user in Model.Users) {

                    <tr>
                        <td>
                          @user.UserName
                        </td>
                        <td>@user.Email</td>
                        <td>   @if (user.AssignedRoles != null && user.AssignedRoles.Any())
                               {
                                   @string.Join(", ", user.AssignedRoles)
                               }
                               else
                               {
                                   <span class="text-muted">Keine Rolle zugewiesen</span>
                               }</td>
                        <td> @if (user.IsActive)
                             {
                                 <span class="badge bg-success">Aktiv</span>
                             }
                             else
                             {
                                 <span class="badge bg-secondary">Inaktiv</span>
                             }</td>
                        <td>
                          <a href="@Url.Action("EditUser", "Admin", new { id = user.Id })" class="btn btn-sm btn-outline-primary me-1">Bearbeiten</a>
                     </td>
                    </tr>
                }
            
            }
            </tbody>
        </table>
    </div>
    </div>
    <div class="d-flex justify-content-between align-items-center mt-4 flex-wrap gap-2">
        <div class="text-muted small">Zeige 1 bis 10 von 100 Einträgen</div>
        <nav>
            <ul class="pagination pagination-sm mb-0">
                <li class="page-item">
                    <a class="page-link" href="#">Zurück</a>
                </li>
                <li class="page-item active">
                    <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">2</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">3</a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="#">Weiter</a>
                </li>
            </ul>
        </nav>
        <div class="text-muted small">2 Einträge ausgewählt</div>
    </div>
    <div class="mt-4 d-flex flex-wrap gap-2">
        <input type="text" class="form-control w-100 w-md-50" placeholder="Kommentar oder Aktion..."/>
        <button class="btn btn-dark">Anwenden</button>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById('searchButton').addEventListener('click', function() {
            const searchValue = document.getElementById('searchInput').value;
            window.location.href = '@Url.Action("AdminPage", "Admin")?search=' + encodeURIComponent(searchValue);
        });
    </script>
}